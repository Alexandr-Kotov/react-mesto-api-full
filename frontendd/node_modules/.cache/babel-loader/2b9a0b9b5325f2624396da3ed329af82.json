{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\\\u043A\\u043E\\u0442\\\\OneDrive\\\\\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B\\\\praktikum\\\\react-mesto-auth\\\\src\\\\components\\\\App.js\",\n    _s = $RefreshSig$();\n\nimport { api, authApi } from \"../utils/api\";\nimport { ProtectedRoute } from \"./ProtectedRoute\";\nimport { Header } from \"./Header\";\nimport { Main } from \"./Main\";\nimport { Login } from \"./Login\";\nimport { Register } from \"./Register\";\nimport { Footer } from \"./Footer\";\nimport { ImagePopup } from \"./ImagePopup\";\nimport { EditProfilePopup } from \"./EditProfilePopup\";\nimport { EditAvatarPopup } from \"./EditAvatarPopup\";\nimport { AddPlacePopup } from \"./AddPlacePopup\";\nimport { InfoPopup } from \"./InfoPopup\";\nimport React, { useState, useEffect } from \"react\";\nimport { Routes, Route, useNavigate } from \"react-router-dom\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isSuccessPopupOpen, setSuccessPopupOpen] = useState(false);\n  const [isErrorPopupOpen, setErrorPopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [currentUser, setCurrentUser] = useState({\n    isLoggedIn: false\n  });\n  const [cards, setCards] = useState([]);\n  const navigate = useNavigate();\n  useEffect(() => {\n    if (currentUser.isLoggedIn) {\n      Promise.all([api.getProfile(), api.getCardSever()]).then(_ref => {\n        let [user, cards] = _ref;\n        setCurrentUser(prev => {\n          return { ...prev,\n            ...user\n          };\n        });\n        setCards(cards);\n      }).catch(error => console.log(error));\n    }\n  }, [currentUser.isLoggedIn]);\n  useEffect(() => {\n    const jwt = localStorage.getItem(\"jwt\");\n\n    if (jwt) {\n      authApi.getProfile().then(res => {\n        setCurrentUser(prev => {\n          return { ...prev,\n            ...res.data,\n            isLoggedIn: true\n          };\n        });\n      }).catch(error => console.log(error));\n    }\n  }, []);\n\n  const handleEditAvatarClick = () => setIsEditAvatarPopupOpen(true);\n\n  const handleEditProfileClick = () => setIsEditProfilePopupOpen(true);\n\n  const handleAddPlaceClick = () => setIsAddPlacePopupOpen(true);\n\n  const handleCardClick = card => setSelectedCard(card);\n\n  const handleError = () => setErrorPopupOpen(true);\n\n  const handleSuccess = () => setSuccessPopupOpen(true);\n\n  const handleCardLike = card => {\n    const hasMyLike = card.likes.some(like => like._id === currentUser._id);\n    api.toggleLike(card._id, hasMyLike).then(newCard => setCards(state => state.map(c => c._id === card._id ? newCard : c))).catch(err => console.log(err));\n  };\n\n  const handleCardDelete = card => api.deleteCard(card._id).then(() => {\n    setCards(state => state.filter(c => c._id != card._id));\n  }).catch(err => console.log(err));\n\n  const closeAllPopups = () => {\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsEditProfilePopupOpen(false);\n    setSelectedCard(null);\n    setErrorPopupOpen(false);\n    setSuccessPopupOpen(false);\n  };\n\n  const handleUserUpdate = user => api.patchProfile(user).then(res => {\n    setCurrentUser(state => {\n      return { ...state,\n        ...res\n      };\n    });\n    setIsEditProfilePopupOpen(false);\n  }).catch(err => console.log(err));\n\n  const handleAvatarUpdate = _ref2 => {\n    let {\n      avatar\n    } = _ref2;\n    return api.patchAvatar(avatar).then(user => {\n      setCurrentUser(state => {\n        return { ...state,\n          ...user\n        };\n      });\n      setIsEditAvatarPopupOpen(false);\n    }).catch(err => console.log(err));\n  };\n\n  const handleAddPlaceSubmit = cardPayload => api.postCardSever(cardPayload).then(newCard => {\n    setCards([newCard, ...cards]);\n    setIsAddPlacePopupOpen(false);\n  }).catch(err => console.log(err));\n\n  const handleRegistration = signupPayload => authApi.signup(signupPayload).then(handleSuccess).catch(handleError);\n\n  const handleLogin = loginPayload => authApi.signin(loginPayload).then(res => {\n    localStorage.setItem(\"jwt\", res.token);\n    currentUser.isLoggedIn = true;\n    currentUser.email = loginPayload.email;\n    navigate(\"/\");\n  }).catch(handleError);\n\n  const handleLogout = () => {\n    localStorage.removeItem(\"jwt\");\n    setCurrentUser({\n      isLoggedIn: false\n    });\n    navigate(\"/sign-in\");\n  };\n\n  const handleSuccessPopupClose = e => {\n    closeAllPopups(e);\n    navigate(\"/sign-in\");\n  };\n\n  return /*#__PURE__*/_jsxDEV(CurrentUserContext.Provider, {\n    value: currentUser,\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      onLogoutClick: handleLogout\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Routes, {\n      children: [/*#__PURE__*/_jsxDEV(Route, {\n        exact: true,\n        path: \"/sign-in\",\n        element: /*#__PURE__*/_jsxDEV(Login, {\n          onSubmit: handleLogin\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 152,\n          columnNumber: 50\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/sign-up\",\n        element: /*#__PURE__*/_jsxDEV(Register, {\n          onSubmit: handleRegistration\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 43\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/\",\n        element: /*#__PURE__*/_jsxDEV(ProtectedRoute, {\n          children: [/*#__PURE__*/_jsxDEV(Main, {\n            onAddPlace: handleAddPlaceClick,\n            onEditAvatar: handleEditAvatarClick,\n            onEditProfile: handleEditProfileClick,\n            onCardClick: handleCardClick,\n            cards: cards,\n            onCardDelete: handleCardDelete,\n            onCardLike: handleCardLike\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 167,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(EditProfilePopup, {\n      isOpen: isEditProfilePopupOpen,\n      onClose: closeAllPopups,\n      onUserUpdate: handleUserUpdate\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(AddPlacePopup, {\n      isOpen: isAddPlacePopupOpen,\n      onClose: closeAllPopups,\n      onAddCard: handleAddPlaceSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(EditAvatarPopup, {\n      isOpen: isEditAvatarPopupOpen,\n      onClose: closeAllPopups,\n      onAvatarUpdate: handleAvatarUpdate\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(ImagePopup, {\n      onClose: closeAllPopups,\n      card: selectedCard\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(InfoPopup, {\n      onClose: handleSuccessPopupClose,\n      isOpen: isSuccessPopupOpen,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"popup__info-icon popup__info-icon_success\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"popup__info-title\",\n        children: \"\\u0412\\u044B \\u0443\\u0441\\u043F\\u0435\\u0448\\u043D\\u043E \\u0437\\u0430\\u0440\\u0435\\u0433\\u0438\\u0441\\u0442\\u0440\\u0438\\u0440\\u043E\\u0432\\u0430\\u043B\\u0438\\u0441\\u044C!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(InfoPopup, {\n      onClose: closeAllPopups,\n      isOpen: isErrorPopupOpen,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"popup__info-icon popup__info-icon_error\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"popup__info-title\",\n        children: \"\\u0427\\u0442\\u043E-\\u0442\\u043E \\u043F\\u043E\\u0448\\u043B\\u043E \\u043D\\u0435 \\u0442\\u0430\\u043A! \\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u0435\\u0449\\u0451 \\u0440\\u0430\\u0437.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 149,\n    columnNumber: 7\n  }, this);\n}\n\n_s(App, \"7mr6rQIX1tJ+aSq3RKguGdTpW/4=\", false, function () {\n  return [useNavigate];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["C:/Users/кот/OneDrive/Рабочий стол/praktikum/react-mesto-auth/src/components/App.js"],"names":["api","authApi","ProtectedRoute","Header","Main","Login","Register","Footer","ImagePopup","EditProfilePopup","EditAvatarPopup","AddPlacePopup","InfoPopup","React","useState","useEffect","Routes","Route","useNavigate","CurrentUserContext","App","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isSuccessPopupOpen","setSuccessPopupOpen","isErrorPopupOpen","setErrorPopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","isLoggedIn","cards","setCards","navigate","Promise","all","getProfile","getCardSever","then","user","prev","catch","error","console","log","jwt","localStorage","getItem","res","data","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","card","handleError","handleSuccess","handleCardLike","hasMyLike","likes","some","like","_id","toggleLike","newCard","state","map","c","err","handleCardDelete","deleteCard","filter","closeAllPopups","handleUserUpdate","patchProfile","handleAvatarUpdate","avatar","patchAvatar","handleAddPlaceSubmit","cardPayload","postCardSever","handleRegistration","signupPayload","signup","handleLogin","loginPayload","signin","setItem","token","email","handleLogout","removeItem","handleSuccessPopupClose","e"],"mappings":"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","sourcesContent":["import { api, authApi } from \"../utils/api\";\nimport { ProtectedRoute } from \"./ProtectedRoute\";\nimport { Header } from \"./Header\";\nimport { Main } from \"./Main\";\nimport { Login } from \"./Login\";\nimport { Register } from \"./Register\";\nimport { Footer } from \"./Footer\";\nimport { ImagePopup } from \"./ImagePopup\";\nimport { EditProfilePopup } from \"./EditProfilePopup\";\nimport { EditAvatarPopup } from \"./EditAvatarPopup\";\nimport { AddPlacePopup } from \"./AddPlacePopup\";\nimport { InfoPopup } from \"./InfoPopup\";\nimport React, { useState, useEffect } from \"react\";\nimport { Routes, Route, useNavigate } from \"react-router-dom\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\n\nfunction App() {\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = useState(false);\n  const [isSuccessPopupOpen, setSuccessPopupOpen] = useState(false);\n  const [isErrorPopupOpen, setErrorPopupOpen] = useState(false);\n  const [selectedCard, setSelectedCard] = useState(null);\n  const [currentUser, setCurrentUser] = useState({ isLoggedIn: false });\n  const [cards, setCards] = useState([]);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    if (currentUser.isLoggedIn) {\n      Promise.all([api.getProfile(), api.getCardSever()])\n        .then(([user, cards]) => {\n          setCurrentUser((prev) => {\n            return { ...prev, ...user };\n          });\n          setCards(cards);\n        })\n        .catch((error) => console.log(error));\n    }\n  }, [currentUser.isLoggedIn]);\n\n  useEffect(() => {\n    const jwt = localStorage.getItem(\"jwt\");\n    if (jwt) {\n      authApi\n        .getProfile()\n        .then((res) => {\n          setCurrentUser((prev) => {\n            return { ...prev, ...res.data, isLoggedIn: true };\n          });\n        })\n        .catch((error) => console.log(error));\n    }\n  }, []);\n\n\n  const handleEditAvatarClick = () => setIsEditAvatarPopupOpen(true);\n  const handleEditProfileClick = () => setIsEditProfilePopupOpen(true);\n  const handleAddPlaceClick = () => setIsAddPlacePopupOpen(true);\n  const handleCardClick = (card) => setSelectedCard(card);\n  const handleError = () => setErrorPopupOpen(true);\n  const handleSuccess = () => setSuccessPopupOpen(true);\n\n  const handleCardLike = (card) => {\n    const hasMyLike = card.likes.some((like) => like._id === currentUser._id);\n\n    api\n      .toggleLike(card._id, hasMyLike)\n      .then((newCard) => setCards((state) => state.map((c) => (c._id === card._id ? newCard : c))))\n      .catch((err) => console.log(err));\n  };\n\n  const handleCardDelete = (card) =>\n    api\n      .deleteCard(card._id)\n      .then(() => {\n        setCards((state) => state.filter((c) => c._id != card._id));\n      })\n      .catch((err) => console.log(err));\n\n  const closeAllPopups = () => {\n      setIsAddPlacePopupOpen(false);\n      setIsEditAvatarPopupOpen(false);\n      setIsEditProfilePopupOpen(false);\n      setSelectedCard(null);\n      setErrorPopupOpen(false);\n      setSuccessPopupOpen(false);\n    };\n\n  const handleUserUpdate = (user) =>\n    api\n      .patchProfile(user)\n      .then((res) => {\n        setCurrentUser((state) => {\n          return { ...state, ...res };\n        });\n        setIsEditProfilePopupOpen(false);\n      })\n      .catch((err) => console.log(err));\n\n  const handleAvatarUpdate = ({ avatar }) =>\n    api\n      .patchAvatar(avatar)\n      .then((user) => {\n        setCurrentUser((state) => {\n          return { ...state, ...user };\n        });\n        setIsEditAvatarPopupOpen(false);\n      })\n      .catch((err) => console.log(err));\n\n  const handleAddPlaceSubmit = (cardPayload) =>\n    api\n      .postCardSever(cardPayload)\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        setIsAddPlacePopupOpen(false);\n      })\n      .catch((err) => console.log(err));\n\n  const handleRegistration = (signupPayload) =>\n   authApi\n    .signup(signupPayload)\n    .then(handleSuccess)\n    .catch(handleError);\n\n  const handleLogin = (loginPayload) =>\n    authApi\n      .signin(loginPayload)\n      .then((res) => {\n        localStorage.setItem(\"jwt\", res.token);\n        currentUser.isLoggedIn = true;\n        currentUser.email = loginPayload.email;\n        navigate(\"/\");\n      })\n      .catch(handleError);\n\n  const handleLogout = () => {\n    localStorage.removeItem(\"jwt\");\n    setCurrentUser({ isLoggedIn: false });\n    navigate(\"/sign-in\");\n  };\n\n  const handleSuccessPopupClose = (e) => {\n    closeAllPopups(e);\n    navigate(\"/sign-in\");\n  };\n\n  return (\n      <CurrentUserContext.Provider value={currentUser}>\n        <Header onLogoutClick={handleLogout} />\n        <Routes>\n          <Route exact  path=\"/sign-in\" element={<Login onSubmit={handleLogin} />} />\n          <Route path=\"/sign-up\" element={<Register onSubmit={handleRegistration} />} />\n          <Route\n            path=\"/\"\n            element={\n              <ProtectedRoute>\n                <Main\n                  onAddPlace={handleAddPlaceClick}\n                  onEditAvatar={handleEditAvatarClick}\n                  onEditProfile={handleEditProfileClick}\n                  onCardClick={handleCardClick}\n                  cards={cards}\n                  onCardDelete={handleCardDelete}\n                  onCardLike={handleCardLike}\n                />\n                <Footer />  \n              </ProtectedRoute>\n            }\n          />\n        </Routes>\n        <EditProfilePopup\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n          onUserUpdate={handleUserUpdate}\n        />\n\n        <AddPlacePopup\n          isOpen={isAddPlacePopupOpen}\n          onClose={closeAllPopups}\n          onAddCard={handleAddPlaceSubmit}\n        />\n\n        <EditAvatarPopup\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onAvatarUpdate={handleAvatarUpdate}\n        />\n\n        <ImagePopup onClose={closeAllPopups} card={selectedCard} />\n\n        <InfoPopup onClose={handleSuccessPopupClose} isOpen={isSuccessPopupOpen}>\n          <div className=\"popup__info-icon popup__info-icon_success\"></div>\n          <h2 className=\"popup__info-title\">Вы успешно зарегистрировались!</h2>\n        </InfoPopup>\n\n        <InfoPopup onClose={closeAllPopups} isOpen={isErrorPopupOpen}>\n          <div className=\"popup__info-icon popup__info-icon_error\"></div>\n          <h2 className=\"popup__info-title\">Что-то пошло не так! Попробуйте ещё раз.</h2>\n        </InfoPopup>\n      </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}